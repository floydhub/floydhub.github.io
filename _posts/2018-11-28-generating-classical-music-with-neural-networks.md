---
author: Charlie Harrington
date: 2018-11-28 18:16:03 +0000
excerpt: Christine McLeavey Payne may have finally cured songwriter's block. Her recent
  project Clara is a long short-term memory (LSTM) neural network that composes piano
  and chamber music. Just give Clara a taste of your magnum-opus-in-progress, and
  Clara will figure out what you should play next.
feature_image: /assets/images/hero/generating-classical-music-with-neural-networks-hero.jpeg
layout: post
slug: generating-classical-music-with-neural-networks
tags: [machine-learning]
title: Generating Classical Music with Neural Networks
---

Christine McLeavey Payne may have finally cured songwriter's block. Her recent project [Clara](http://christinemcleavey.com/clara-a-neural-net-music-generator/) is a [long short-term memory (LSTM)](https://floydhub.github.io/long-short-term-memory-from-zero-to-hero-with-pytorch/) neural network that composes piano and chamber music. Just give Clara a taste of your magnum-opus-in-progress, and Clara will figure out what you should play next.

Take a listen to this jazz piano selection generated by Clara:

Want more? Clara can also write duets ‚Äì here's a violin and piano composition:

Christine is a Fellow on the Technical Staff at [OpenAI](https://openai.com/), a non-profit AI research company focused on discovering and enacting the path to safe artificial general intelligence. At OpenAI, Christine focuses on Multiagent Learning, studying how agents learn very advanced behaviors by competing and cooperating with other agents, rather than what they could learn on their own in an environment.

Christine's also an accomplished classical pianist ‚Äì she graduated from The Juilliard School and is the founding pianist of Ensemble San Francisco. She also has a Master‚Äôs Degree in Neuroscience from Stanford University. Oh, and she has two young kids! 

She's pretty much the coolest person in the universe.

As you might expect, I'm thrilled to share my conversation with Christine for this [Humans of Machine Learning ](https://floydhub.github.io/tag/humans-of-ml/)([#humansofml](https://twitter.com/hashtag/humansofml?src=hash)) interview. In this post, we're going to dig into the neural network behind Clara, as well as Christine's own journey with AI and deep learning.

**Okay, let's dive in.**How exactly does Clara work?****

Clara is based on the idea that you can generate music in the same way that you generate language.

When we train a language model, we feed the neural network a paragraph and then ask it to predict the next word (‚Äúto be or not to ___‚Äù). Once you have a model that is good at predicting the next word, you can easily turn that into a generator. As it predicts a next word, you then feed that word back into the model and ask it to predict the _next_ word after that, and so forth.

Of course, part of the difficulty is figuring out how to translate words (or notes) into vectors that you can pass directly into the model. A lot of my work was finding a good encoding for the music!

****Why did you use an long short-term memory (LSTM) architecture for Clara?****

Jeremy Howard and Sebastien Ruder achieved [great results](https://nlp.fast.ai/classification/2018/05/15/introducing-ulmfit.html) using an LSTM for language model. More recently, there is a shift towards using a [Transformer](https://arxiv.org/abs/1706.03762) architecture, and right now I‚Äôm experimenting with that as well.

****Let‚Äôs** talk more about the data and the data**encoding process for Clara.** W**here did you get the music for the dataset?****

I used midi files from [Classical Archives](https://www.classicalarchives.com/), a collection of files that many different musicians have submitted. I found this a particularly useful collection, partly because it is so large, and partly because pieces are separated by composer. Unlike some other classical music datasets, I could easily control which pieces were included, and I could ensure that I didn‚Äôt have multiple copies of the same piece performed by different pianists (I didn‚Äôt want to contaminate things by having a single piece show up in both my training set and my validation set). 

Similarly, I collected jazz pieces from different sources, including [this library.](https://bushgrafts.com/midi/) I used [Beautiful Soup](https://pypi.org/project/beautifulsoup4/) to scrape web pages for all the midi files.

**You decided to**encode these midi files into a text format. Can you tell us more about that process?****

This is a two part process. I first use [MIT‚Äôs music21 library](http://web.mit.edu/music21/) to translate the midi files into a music21 stream. This provides me with the notes and their timing offsets (now with respect to the tempo of the piece).

I then translated those notes and timings into either my chordwise or notewise encodings. I‚Äôll explain those terms in just a moment.

First, let me explain a few extra tricks around encoding the timing of the rests. 

****Wait, what‚Äôs a rest?****

A rest just means silence. You can have rests of different lengths that tell you how long to wait before playing the next note.

In the chordwise version, I use the term ‚Äúrest‚Äù more generally. Basically, I mean any time step where you don‚Äôt play any new notes. The trouble is, if the time steps are frequent (say 4 times, or even 12 times per quarter note), most of the time you‚Äôre not playing any new notes. Approximately 40% of the time, you have this ‚Äúdo nothing‚Äù indication, and if you naively trained a model on this, the neural net would just learn to predict rest all the time, since at least then it would be correct 40% of the time.

Therefore, I developed a trick where I re-encode the rests. Instead of predicting a single rest token, I instead count the number of total notes in the previous 10 timesteps. This has two functions: first, there‚Äôs no way for the model to fall into the easy local minimum of always predicting ‚Äúrest‚Äù. Second, models often train to higher accuracies if you give them an auxiliary but related task. In order to do well on this task, the model has to understand something about the structure of the music.

**Can you explain these terms**_chordwise_ and _notewise_? **Even more generally, w**hat‚Äôs a chord versus a note?****

Here I‚Äôm using ‚Äúchord‚Äù in a very general sense - I mean any combination of notes played at one time. Often this might be a traditional musical chord (for example C major would be C, E, and G played together), but it can be any arbitrary combination. In theory, this could be 2^88 possible different combinations, but in practice music is much more predictable, and I found around 60,000 different chords in the data set. 

![](/assets/images/content/images/2019/08/chords.png)Different text encoding formats for midi files: chordwise and notewise

A chordwise file looks like this:
    
    
    p00000010000000000100000000 p0000000100000000000000 p00000000000100000000000

I‚Äôve shown it here for a small note range (this would be three chords in a row, and the `p` is for piano). There is a `1` for any note that is played at that time step, and then a `0` otherwise. Next, I take the set of all possible chords, and that is my vocabulary.

A notewise file looks like this
    
    
    p20 p32 wait3 endp20 p25 endp32 wait12

With notewise encodings, I indicate:

  * the starts of notes ( `p20` is the piano playing pitch 20)
  * the ends of notes (this way you could hold a note for an arbitrarily long time), 
  * and a wait signal that indicates the end of one musical time step, as well as how long to wait before the next change.

**Why did you take two approaches for the encoding of the midi files? Did you try chordwise first, and then move towards notewise based on the model results?**

Yes, I‚Äôve been frustrated with the chordwise results. It tends to overfit to the training set (for example, if I prompt it with the start of a Mozart sonata, it then continues generating the whole rest of that sonata). You can listen to a chordwise example here, which fully reproduces the Mozart sonata:

The chordwise encoding didn‚Äôt generalize as well, and it also failed on prompts from the validation set.

The notewise version, on the other hand, has a harder time with long term structure, but it is much more flexible, and it performs well even when it moves into territory far from what it trained on. Here is a sample notewise generation from Clara:

**I thought your data augmentation strategy was very clever -- transposing the midi files into all possible keys. Please tell me you automated that in some way!**

Yes, of course! It‚Äôs actually very easy, I can simply add or subtract an offset to every single pitch. I have to admit I was tempted to spend a day ‚Äúaugmenting‚Äù the data set by sitting at a piano keyboard and recording myself playing for a few hours.

**For your sampling, why did you use only 62 notes instead of the full 88-keys on a traditional piano?**

This is a great question. Originally, I cut the range because I was worried about my vocab size being too large. Although in practice, pianists almost never use notes outside that range (in my entire data set, it meant cutting out 3 notes). It should all work with the full 88 keys as well, although those extra notes are so rare in the training data that the model will never learn to predict any of them.

**Moving to Clara's music generation, it appears that you started using arbitrary choices among the top best guesses instead of the very top best guess. Where did this insight come from?**

Sampling the generation well is extremely important. My idea was that in music there are often multiple options for next notes or chords that would all sound good.

So, rather than only take the model‚Äôs top prediction (which might fall into short repetitive loops), it is interesting to sometimes sample 2nd and 3rd guesses.   
I think this would be an interesting topic for future work. Ideally, you might set up a beam search. At each generation step, keep your top 3 notes, then feed all of those into the model and predict 3 notes for each of those. Now, of the 9 generations, keep only the 3 best and feed those into the model, and so forth. 

In music, we have a very common structure: play a short phrase once, repeat it exactly once, and then on the third time, start to repeat, but then continue on to a longer thought. I‚Äôd love to find a way to get a neural net to generate this.

### Ready to build, train, and deploy AI?

#### Get started with FloydHub's collaborative AI platform for free

###### [Try FloydHub for free ](https://www.floydhub.com/?utm_source=blog&utm_medium=banner&utm_campaign=try_floydhub_for_free)

**Oh, I forgot to ask -- why the name Clara?**

This is in honor of Clara Schumann. She was an incredible pianist and composer, living in Germany in the mid-1800‚Äôs. Here‚Äôs a gorgeous [piano romance](https://www.youtube.com/watch?v=9QJnb1EXnEg&t=457s) she composed, and she was considered one of the leading concert pianists of her day. She was also married to Robert Schumann, very close friends with Johannes Brahms, and mom to 8 kids. 

**Is your project publicly available for people to reproduce?**

Yes! The project is available here: <https://github.com/mcleavey/musical-neural-net>

**What role do you see for AI in music? When will composers start using tools like Clara? Sorry, that was two questions.**

At the moment, I think the best use for a tool like Clara would be in partnership with a human composer. Clara is very good at coming up with new patterns and ideas, but then as I listen to a generation, I notice points where I‚Äôd then want to break away from Clara‚Äôs idea. As mentioned, I‚Äôm not a composer, but Clara was making me want to try again, so I can only imagine that a great composer could take this in very interesting directions.

On a more practical note, I can imagine AI music generation being used for film scores. It would be really interesting to condition the music generations on the emotion or timing of the scene. Plus, we‚Äôre much more forgiving about a film score not having a large scale plan - we usually just want music that adds to the mood, but doesn‚Äôt draw our attention to itself.

**I‚Äôm imagining an app that lets you play a few notes on a piano, and then Clara will suggest the next few notes to play. Is that possible with Clara? It could be a songwriter‚Äôs dream. The end of songwriter‚Äôs block!**

That‚Äôs a great idea! It should definitely be possible if you played on a keyboard that can record a midi file. There‚Äôs a midi-to-encoding file in the project that could take that and turn it into a prompt for Clara.

**W**ho are your** own **favorite composers?****

That‚Äôs a tough question, there are too many! I always come back to Brahms and Rachmaninoff on the classical side. Rachmaninoff‚Äôs cello and piano sonata is probably my all-time favorite piece both to play and to listen to (especially the [third movement](https://www.youtube.com/watch?v=k_aBwXWGyrs)!). I‚Äôm also obsessed with Ella Fitzgerald, and I love so many of the songs she sang. 

****Have you written any music yourself?****

Sadly, no. When I was 5, I composed a piece and I was very excited about it, and then a few days later realized it was actually something I‚Äôd heard Sesame Street. That was probably the peak of my composing career.

**As someone who used to make games and now works at OpenAI, have you tried your hand at Dota 2 yet?**

No, I really need to try it. We have a games night occasionally at OpenAI where people hang out and play Dota. I‚Äôve picked up a bit from watching the matches, but I still feel like they‚Äôre speaking a foreign language, it‚Äôs such an involved game! It‚Äôs exciting to be around the project though.

**What are you hoping to learn or tackle next in your career?**

My main goal is to build things that help people. It‚Äôs why I‚Äôve been drawn to creating educational games in the past, and why I love the OpenAI [mission statement](https://openai.com/about/). 

**Any advice for people who want to get started with deep learning?**

I wrote a [blog post](http://christinemcleavey.com/learning-about-deep-learning/) about my favorite resources for getting started. My main advice is just to dive in. It‚Äôs easy to feel overwhelmed and to think you don‚Äôt have the right background, but by now there are some great online courses. I‚Äôd recommend starting at the level of fastai or Keras, and then dive into the details of PyTorch or TensorFlow afterwards if you find yourself pushing the boundaries.

**In a recent fast.ai lecture, Jeremy Howard mentioned his advice to you to ‚ÄúPick one project and make it fantastic.‚Äù How did you interpret this advice?**

I‚Äôm very guilty of this one - I tend to have a million ideas, and I start lots of projects. I took this advice from Jeremy to mean: `have the discipline to focus on one project and really follow through with it`. Work through the boring details, try to make the code well organized and commented. Also, remember that if you‚Äôre applying for a job, first impressions do matter. It‚Äôs worth the effort of making a website or other display for it that will catch people‚Äôs attention.

**You‚Äôve written about the difference between active learning and passive learning. Can you elaborate a bit more on that?**

I think there are two different levels of learning a new area as a programmer. There‚Äôs the passive level where you can follow code that‚Äôs already written, and then there‚Äôs the active level where you can write that from scratch, or where you can make changes to it and experiment with that. In the same way, I feel I only really know a topic when I can take what I‚Äôve learned and then teach it to someone else. It‚Äôs absolutely key to get to that second level of understanding and fluency.

**Finally, is it too late for me to learn how to play piano?**

You should go for it! The only thing I‚Äôd say is to be patient and to enjoy learning. I often think the great advantage kids have over adults is that they‚Äôre fine with being bad at something for a long time. It takes kids 5-10 years to get good at piano, but they don‚Äôt worry that they sound awful along the way. It‚Äôs all about loving that feeling of starting something totally new. 

**This was great! I‚Äôm going to get that keyboard soon. Thank you, Christine, for chatting with me. Where can people go to learn more about you and your work?**

Thanks, these were great questions! You can [visit my website](http://www.christinemcleavey.com) or I‚Äôm also active on [Twitter](http://www.twitter.com/mcleavey).

* * *

A couple of months after this interview Christine published [MuseNet](https://openai.com/blog/musenet/), where she used [GPT-2](https://floydhub.github.io/gpt2/), a [transformer base model](https://floydhub.github.io/the-transformer-in-pytorch/), to generate music with amazing results. üéâ

> Introducing MuseNet, a neural network which discovered how to generate music using many different instruments and styles.   
> Listen & interact: <https://t.co/yudNpaerz9>  
>   
> MuseNet will play an experimental concert today from 12‚Äì3pmPT on livestream: <https://t.co/CRx0goxVrh> [pic.twitter.com/7tPMEd4tpa](https://t.co/7tPMEd4tpa)
> 
> -- OpenAI (@OpenAI) [April 25, 2019](https://twitter.com/OpenAI/status/1121457782312460288?ref_src=twsrc%5Etfw)

We also recommend to watch this small video interview with Andrew Ng.

> Christine finished the [Deep Learning Specialization](https://floydhub.github.io/best-deep-learning-courses-updated-for-2019/#deep-learning-specialization) a year ago. Now she's a full-time OpenAI research scientist building neural networks that create original music. Christine and Andrew chat about the tech behind her latest project, MuseNet, and her advice for those wanting to start their own careers in ML.